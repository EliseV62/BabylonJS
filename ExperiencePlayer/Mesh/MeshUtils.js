define("DS/Mesh/MeshUtils",["DS/Mesh/Mesh","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialManager","DS/Visualization/GraphicAttributeSet"],(function(n,r,l,e){"use strict";return n.zKn=function(n,l){if(n.length){for(var e=[],a=null,o=null,i=new r.Sphere,u=new r.Box3,t=0;t<n.length;t++){var w=n[t],f=new r.BufferGeometryDS,v=new r.Vector3(w.AABB.min[0],w.AABB.min[1],w.AABB.min[2]),s=new r.Vector3(w.AABB.max[0],w.AABB.max[1],w.AABB.max[2]);null==a&&(a=v),null==o&&(o=s),v.x<a.x&&(a.x=v.x),v.y<a.y&&(a.y=v.y),v.z<a.z&&(a.z=v.z),s.x>o.x&&(o.x=s.x),s.y>o.y&&(o.y=s.y),s.z>o.z&&(o.z=s.z),u.set(a,o),i.radius=o.clone().sub(a).multiplyScalar(.5).length(),i.center=o.clone().add(a).multiplyScalar(.5);for(var c=0;c<w.drawingGroups.length;c++)w.drawingGroups[c].geometry=f;f.drawingGroups=w.drawingGroups,f.vertexPositionArray=w.vertexPositionArray,null!==w.vertexNormalArray&&(f.vertexNormalArray=w.vertexNormalArray),null!==w.vertexUvArray&&(f.vertexUvArray=w.vertexUvArray),w.vertexUv2Array&&(f.vertexUv2Array=w.vertexUv2Array),w.vertexTangentArray&&(f.vertexTangentArray=w.vertexTangentArray),w.vertexBinormalArray&&(f.vertexBinormalArray=w.vertexBinormalArray),f.vertexIndexArray=w.vertexIndexArray,e.push(f)}return e.boundingSphere=i,e.boundingBox=u,e}},n.convertTo3jsMesh=function(a,o,i,u,t,w){if(a.length){for(var f=window.cQi,v=null,s=[],c=null,y=null,A=new r.Sphere,h=new r.Box3,d=new l,F=!1,M=0;M<a.length;M++){var D=a[M],S=new r.BufferGeometryDS;S.editable=D.editable,void 0!==u&&(S.sharedBuffers=u),void 0!==t&&(S.noMeshInRAM=t);var m=new r.Vector3(D.AABB.min[0],D.AABB.min[1],D.AABB.min[2]),b=new r.Vector3(D.AABB.max[0],D.AABB.max[1],D.AABB.max[2]);null==c&&(c=m),null==y&&(y=b),m.x<c.x&&(c.x=m.x),m.y<c.y&&(c.y=m.y),m.z<c.z&&(c.z=m.z),b.x>y.x&&(y.x=b.x),b.y>y.y&&(y.y=b.y),b.z>y.z&&(y.z=b.z),h.set(c,y),A.radius=y.clone().sub(c).multiplyScalar(.5).length(),A.center=y.clone().add(c).multiplyScalar(.5);for(var T=0;T<D.drawingGroups.length;T++){var U=D.drawingGroups[T];if(F||0!==U._geomType&&(F=!0),U.geometry=S,void 0!==i&&i){var p=null,E=null,R=U.gas,g=U.material;if(g)U.gas=g;else if(null!==R)if(null!=E&&n.areEqualGraphicProperties(E,R))U.gas=p;else{var x=new r.Color;x.eMi(R.color.r,R.color.g,R.color.b);var z={color:x,opacity:R.opacity};if(R.linewidth&&(R.lineWidth=R.linewidth),R.lineWidth?(z.lineWidth=R.lineWidth,R.pattern&&(z.pattern=R.pattern)):R.ktr?(z.symbol=0,z.size=R.ktr):z.solid=R.solid,f){var G={colorRGB:z.color,colorA:z.opacity,side:1===z.solid?0:2,inheritance:r.GASEnum.RGBA_INHERIT};z.lineWidth&&(G.lineWidth=z.lineWidth,G.inheritance|=r.GASEnum.LINEWIDTH_INHERIT),z.pattern&&(G.lineType=z.pattern,G.inheritance|=r.GASEnum.LINETYPE_INHERIT),void 0!==z.symbol&&(G.symbolType=R.symbol,G.inheritance|=r.GASEnum.SYMBOLTYPE_INHERIT),U.gas=new e(G)}else U.gas=d.getMaterialFromGAS(z);p=U.gas,E=R}}}S.drawingGroups=D.drawingGroups,w&&(S.decorations=w),S.vertexPositionArray=D.vertexPositionArray,null!==D.vertexNormalArray&&(S.vertexNormalArray=D.vertexNormalArray),null!==D.vertexColorArray&&(S.vertexColorArray=D.vertexColorArray),null!==D.vertexUvArray&&(S.vertexUvArray=D.vertexUvArray),D.vertexUv2Array&&(S.vertexUv2Array=D.vertexUv2Array),D.vertexTangentArray&&(S.vertexTangentArray=D.vertexTangentArray),D.vertexBinormalArray&&(S.vertexBinormalArray=D.vertexBinormalArray),S.vertexIndexArray=D.vertexIndexArray,o&&(o.gEi||o.dEi&&o.dEi.gEi)&&S.YQe(a.patternOffsets),s.push(S)}A.radius||(A.radius=.1),h.min.distanceToSquared(h.max)||h.yhn(.1),s.boundingSphere=A,s.boundingBox=h,(v=new r.Mesh(s,o)).URi=!1,v.castShadow=!0,v.receiveShadow=!0;var H=new n.SGBag;return H.children.push(a[0].rep),a[0].rep.QC.push(H),v.sceneGraph=H,v.fNi=F,v}},n.y5e=function(){var n=new r.BufferGeometryDS;n.boundingSphere=new r.Sphere(new r.Vector3,0),n.boundingBox=new r.Box3;var l=r.MaterialUtils.xm();return mesh=new r.Mesh(n,l),mesh.URi=!1,mesh.castShadow=!0,mesh.receiveShadow=!0,new THREEDS.Nodes.Mesh(mesh)},n.convertTo3js=function(n,l,e,a){var o,i=null,u=[],t=null,w=null,f=new r.Sphere,v=new r.Box3,s=new THREEDS.MaterialManager;s._5e();for(var c=0;c<n.length;c++){var y=n[c],A=new r.BufferGeometryDS,h=new r.Vector3(y.AABB.min[0],y.AABB.min[1],y.AABB.min[2]),d=new r.Vector3(y.AABB.max[0],y.AABB.max[1],y.AABB.max[2]);null==t&&(t=h),null==w&&(w=d),h.x<t.x&&(t.x=h.x),h.y<t.y&&(t.y=h.y),h.z<t.z&&(t.z=h.z),d.x>w.x&&(w.x=d.x),d.y>w.y&&(w.y=d.y),d.z>w.z&&(w.z=d.z),v.set(t,w),f.radius=w.clone().sub(t).multiplyScalar(.5).length(),f.center=w.clone().add(t).multiplyScalar(.5);for(var F=0;F<y.drawingGroups.length;F++){y.drawingGroups[F].geometry=A;var M=y.drawingGroups[F].gas,D=y.drawingGroups[F].material;if(a&&null!==D&&!D.file&&-1!==D.id)null!=a[D.id]?o=a[D.id]:(o=s.p5e(l[D.id],void 0,"CGR",e,y.drawingGroups[F]),a[D.id]=o),y.drawingGroups[F].gas=o;else if(null!==M&&M.color){var S=new r.Color;S.eMi(M.color.r,M.color.g,M.color.b),y.drawingGroups[F].gas=s.getMaterialFromGAS({color:S,opacity:M.opacity,lineWidth:M.lineWidth?M.lineWidth:M.linewidth,solid:M.solid,symbol:M.symbol,basic:M.basic,resource:e})}}A.drawingGroups=y.drawingGroups,A.vertexPositionArray=y.vertexPositionArray,null!==y.vertexNormalArray&&(A.vertexNormalArray=y.vertexNormalArray),null!==y.vertexUvArray&&(A.vertexUvArray=y.vertexUvArray),y.vertexUv2Array&&(A.vertexUv2Array=y.vertexUv2Array),y.vertexTangentArray&&(A.vertexTangentArray=y.vertexTangentArray),y.vertexBinormalArray&&(A.vertexBinormalArray=y.vertexBinormalArray),A.vertexIndexArray=y.vertexIndexArray,u.push(A)}var m=new r.Color;m.eMi(n[0].gas.fill.color.r,n[0].gas.fill.color.g,n[0].gas.fill.color.b);var b=new r.Color;return b.eMi(n[0].gas.line.color.r,n[0].gas.line.color.g,n[0].gas.line.color.b),(D=s.getMaterialFromGAS({color:m,opacity:n[0].gas.fill.opacity,solid:n[0].gas.fill.solid,basic:n[0].gas.fill.basic})).line=s.getMaterialFromGAS({color:b,opacity:n[0].gas.line.opacity,lineWidth:n[0].gas.line.lineWidth?n[0].gas.line.lineWidth:n[0].gas.line.linewidth}),u.boundingSphere=f,u.boundingBox=v,(i=new r.Mesh(u,D)).URi=!1,i.castShadow=!0,i.receiveShadow=!0,n.length&&(i.sceneGraph=n[0].sceneGraph),new THREEDS.Nodes.Mesh(i)},n.mergeGeometries=function(r,l){if(!l)throw new"no clone link";r.invalidRatio=r.invalidRatio||0;for(var e=0,a=0,o=[],i=0,u=!1,t=!1,w=!1,f=!1,v=!1,s=!1,c=0;c<r.layers.length;c++){(h=r.layers[c].VNi).Owi<=0&&(i+=h.count)}for(c=0;c<r.geometries.length;c++){e+=(K=r.geometries[c]).vertexIndexArray.length,a+=K.vertexPositionArray.length,o[c]=K.vertexPositionArray.length,u=null!==K.vertexNormalArray,t=null!==K.vertexUvArray,w=null!==K.vertexUv2Array,f=null!==K.vertexColorArray,v=null!==K.vertexTangentArray,s=null!==K.vertexBinormalArray}if(!i&&!r.force)return null;if(!r.force&&i/e<r.invalidRatio)return null;var y=new n.SGPrimitiveHelper,A=[];for(c=0;c<r.layers.length;c++){var h,d=r.layers[c].$Ni;if(l.has(d)||l.set(d,new Map),(h=r.layers[c].VNi).Owi>0)for(var F=h.tRi;F<h.tRi+h.iRi;F++)y.set(d,F),A.push(y.clone())}A.sort((function(n,r){var l=n.getGroup(),e=r.getGroup();return l.glType<e.glType?-1:l.glType>e.glType?1:l._geomType<e._geomType?-1:l._geomType>e._geomType?1:null===l.gas?-1:null===e.gas?1:l.gas.id<e.gas.id?-1:l.gas.id>e.gas.id?1:0}));var M=[];for(c=0;c<o.length;c++){M[c]=new Int32Array(o[c]/3);for(F=0;F<M[c].length;F++)M[c][F]=-1}var D=[],S=[],m=[],b=[],T=[],U=[],p=[],E=[],R=[],g=[],x=Math.min(a,196608),z=Math.min(4*a/3,262144);S[0]=new Float32Array(x),m[0]=u?new Float32Array(x):null,b[0]=t?new Float32Array(x):null,T[0]=w?new Float32Array(x):null,U[0]=f?new Float32Array(z):null,p[0]=v?new Float32Array(x):null,E[0]=s?new Float32Array(x):null,R[0]=new Uint16Array(e);var G=(nn=A[0].getGroup()).glType,H=nn._geomType,V=nn.gas,W=[],k=[],B=[],C=0,I=0,J=0,_=0,j=0;for(c=0;c<A.length;c++){var q=A[c],K=(d=q.getGroup()).geometry,L=r.geometries instanceof Array?r.geometries.indexOf(K):0,N=K.vertexPositionArray,O=K.vertexNormalArray,P=K.vertexUvArray,Q=K.vertexUv2Array,X=K.vertexColorArray,Y=K.vertexTangentArray,Z=K.vertexBinormalArray,$=K.vertexIndexArray;if(I+q.getCount()>=65536){var nn=new n.DrawingGroup(V,V,G,J,j-J,void 0,void 0,H);W.push(nn);for(F=0;F<k.length;F++){var rn=B[F];y.set(nn,nn.tEi.length),k[F].group=nn,nn.tEi.push(k[F]),l.get(rn.container).set(rn.index,y.clone())}k=[],B=[],g[C]=W,D[C]={index:j,data:I},G=d.glType,H=d._geomType,V=d.gas,W=[],I=0,J=0,_=0,j=0,x=196608,z=262144,S[++C]=new Float32Array(x),m[C]=u?new Float32Array(x):null,b[C]=t?new Float32Array(x):null,T[C]=w?new Float32Array(x):null,U[C]=f?new Float32Array(z):null,p[C]=v?new Float32Array(x):null,E[C]=s?new Float32Array(x):null,R[C]=new Uint16Array(e);for(var ln=0;ln<o.length;ln++)for(F=0;F<M[ln].length;F++)M[ln][F]=-1}else if(d.glType!==G||d.gas!==V||d._geomType!==H){nn=new n.DrawingGroup(V,V,G,J,j-J,void 0,void 0,H);G=d.glType,H=d._geomType,V=d.gas,W.push(nn),J=j;for(F=0;F<k.length;F++){rn=B[F];y.set(nn,nn.tEi.length),k[F].group=nn,nn.tEi.push(k[F]),l.get(rn.container).set(rn.index,y.clone())}k=[],B=[]}_=j;for(F=0;F<q.getCount();F++){var en=$[q.getStart()+F],an=M[L][en];if(-1===an){for(var on=0;on<3;on++)S[C][3*I+on]=N[3*en+on],u&&(m[C][3*I+on]=O[3*en+on]),t&&(b[C][3*I+on]=P[3*en+on]),w&&(T[C][3*I+on]=Q[3*en+on]),v&&(p[C][3*I+on]=Y[3*en+on]),s&&(E[C][3*I+on]=Z[3*en+on]);if(f)for(on=0;on<4;on++)U[C][4*I+on]=X[4*en+on];M[L][en]=I,R[C][j++]=I,I++}else R[C][j++]=an}var un=q.ytr();un.start=_,k.push(un),B.push(q)}if(k.length>0){nn=new n.DrawingGroup(V,V,G,J,j-J,void 0,void 0,H);W.push(nn);for(F=0;F<k.length;F++){rn=B[F];y.set(nn,nn.tEi.length),k[F].group=nn,nn.tEi.push(k[F]),l.get(rn.container).set(rn.index,y.clone())}k=[],B=[],g[C]=W,D[C]={index:j,data:I}}var tn=C+1,wn=null;for(c=0;c<tn;c++){x=D[c];var fn=R[c],vn=S[c],sn=m[c],cn=(P=b[c],Q=T[c],U[c]),yn=p[c],An=E[c];if(x.index<fn.length){wn=new Uint16Array(x.index);for(F=0;F<x.index;F++)wn[F]=fn[F];R[c]=wn}if(3*x.data<vn.length){var hn=3*x.data,dn=4*x.data;wn=new Float32Array(hn);for(F=0;F<hn;F++)wn[F]=vn[F];if(S[c]=wn,u){wn=new Float32Array(hn);for(F=0;F<hn;F++)wn[F]=sn[F];m[c]=wn}if(t){wn=new Float32Array(hn);for(F=0;F<hn;F++)wn[F]=P[F];b[c]=wn}if(w){wn=new Float32Array(hn);for(F=0;F<hn;F++)wn[F]=Q[F];T[c]=wn}if(f){wn=new Float32Array(dn);for(F=0;F<dn;F++)wn[F]=cn[F];U[c]=wn}if(v){wn=new Float32Array(hn);for(F=0;F<hn;F++)wn[F]=yn[F];p[c]=wn}if(s){wn=new Float32Array(hn);for(F=0;F<hn;F++)wn[F]=An[F];E[c]=wn}}}var Fn=[];for(c=0;c<tn;c++){var Mn=new n.Mesh;Mn.vertexPositionArray=S[c],Mn.vertexNormalArray=m[c],Mn.vertexUvArray=b[c],Mn.vertexUv2Array=T[c],Mn.vertexColorArray=U[c],Mn.vertexTangentArray=p[c],Mn.vertexBinormalArray=E[c],Mn.vertexIndexArray=R[c],Mn.drawingGroups=g[c];var Dn=[0,0,0],Sn=[0,0,0];if(S[c].length>=3){Dn=[S[c][0],S[c][1],S[c][2]],Sn=[S[c][0],S[c][1],S[c][2]];for(var mn=0;mn<S[c].length;mn+=3)S[c][mn]<Dn[0]&&(Dn[0]=S[c][mn]),S[c][mn+1]<Dn[1]&&(Dn[1]=S[c][mn+1]),S[c][mn+2]<Dn[2]&&(Dn[2]=S[c][mn+2]),S[c][mn]>Sn[0]&&(Sn[0]=S[c][mn]),S[c][mn+1]>Sn[1]&&(Sn[1]=S[c][mn+1]),S[c][mn+2]>Sn[2]&&(Sn[2]=S[c][mn+2])}Mn.AABB={min:Dn,max:Sn},Fn.push(Mn)}return n.zKn(Fn,null)},n.GKn=function(r,l,e,a,o){var i=n.hhs(r.ohi,r.qP,r.JP,r.HKn,l,null);return n.convertTo3jsMesh([i],e,!1,a,o)},n.WKn=function(r,l,e,a,o){var i=new multiTabDecorations,u=n.rhs(r.bottomCenter,r.topCenter,r.Lee,r.Fee,l,null,r.sag,!1,i);return n.convertTo3jsMesh([u],e,!1,a,o,i.Mes())},n.kKn=function(r,l,e,a,o){var i=new multiTabDecorations,u=n.whs(r.y1e,r.b1e,r.w1e,r.C1e,r.center,r.qP,r.JP,l,null,r.sag,!1,i);return n.convertTo3jsMesh([u],e,!1,a,o,i.Mes())},n.BKn=function(l,e,a,o,i){for(var u=[],t=[],w=0,f=0;f<l.ehs.length/3;f++)t.push(l.radius),u.push(new r.Vector3(l.ehs[w++],l.ehs[w++],l.ehs[w++]));var v=new r.Vector3(l.ahs[0],l.ahs[1],l.ahs[2]),s=new r.Vector3(l.fhs[0],l.fhs[1],l.fhs[2]),c=n.ohs(u,t,v,s,!0,e,null,l.sag);return n.convertTo3jsMesh([c],a,!1,o,i)},n.JKn=function(l,e,a,o,i){var u=new multiTabDecorations,t=new r.Vector3(l.planeNormal[0],l.planeNormal[1],l.planeNormal[2]),w=t.length();t.normalize();var f=new r.Vector3(-l.planeNormal[2],l.planeNormal[0],-l.planeNormal[1]),v=new r.Vector3;v.crossVectors(t,f),v.normalize();var s=new r.Vector3;s.crossVectors(t,v),s.normalize(),v.multiplyScalar(w),s.multiplyScalar(w);for(var c=new r.Vector3(l.center[0],l.center[1],l.center[2]),y=n.dhs(c,v,s,2*Math.PI,l.sag),A=[],h=[],d=0,F=0;F<y.ehs.length/3;F++)h.push(l.lne),A.push(new r.Vector3(y.ehs[d++],y.ehs[d++],y.ehs[d++]));var M=new r.Vector3(y.startNormal[0],y.startNormal[1],y.startNormal[2]),D=n.Ahs(c,A,h,M,e,null,l.sag,!1,u);return n.convertTo3jsMesh([D],a,!1,o,i,u.Mes())},n.jKn=function(l,e,a,o,i){for(var u=new multiTabDecorations,t=new r.Vector3(l.center[0],l.center[1],l.center[2]),w=n.dhs(t,new r.Vector3(l.qP[0],l.qP[1],l.qP[2]),new r.Vector3(l.JP[0],l.JP[1],l.JP[2]),l.bhs,l.sag),f=[],v=[],s=0,c=0;c<w.ehs.length/3;c++)v.push(l.lne),f.push(new r.Vector3(w.ehs[s++],w.ehs[s++],w.ehs[s++]));var y=new r.Vector3(w.startNormal[0],w.startNormal[1],w.startNormal[2]),A=new r.Vector3(w.endNormal[0],w.endNormal[1],w.endNormal[2]),h=n.ohs(f,v,y,A,!0,e,null,l.sag,!1,u,l);return n.convertTo3jsMesh([h],a,!1,o,i,u.Mes())},n})),define("Mesh/MeshUtils",["DS/Mesh/MeshUtils","DS/DSMigration/DSMigration"],(function(n,r){return r.mH("Mesh/MeshUtils"),n}));