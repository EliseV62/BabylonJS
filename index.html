<!DOCTYPE html>
<html>
    <head>
        <title>Three.js TypeScript Tutorials by Sean Bradley : https://sbcode.net/threejs</title>
        <meta name="author" content="Sean Bradley" />
        <link rel="stylesheet" href="/stylesheets/style.css" />
        <style>
            body {
                overflow: hidden;
                margin: 0px;
            }

            #progressBar {
                width: 500px;
                height: 24px;
                position: absolute;
                left: 50%;
                top: 10px;
                margin-left: -250px;
            }
        </style>
        <!-- Import maps polyfill -->
        <!-- Remove this when import maps will be widely supported -->
        <script async src="./utils/es-module-shims.js"></script>

        <script type="importmap">
            {
                "imports": {
                    "three": "/build/three.module.js",
                    "three/examples/jsm/controls/OrbitControls": "/jsm/controls/OrbitControls.js",
                    "three/examples/jsm/loaders/GLTFLoader": "/jsm/loaders/GLTFLoader.js",
                    "three/examples/jsm/libs/stats.module": "/jsm/libs/stats.module.js"
                }
            }
        </script>
    </head>

    <body>
        <a href="/view_source/loader-gltf.html" id="vwSrcLink" target="_blank">&lt;&gt;</a>
        <progress value="0" max="100" id="progressBar"></progress>
        <script type="module">
            import * as THREE from 'three'
            import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls'
            import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'
            import Stats from 'three/examples/jsm/libs/stats.module'
            const scene = new THREE.Scene()
            const axesHelper = new THREE.AxesHelper(5)
            scene.add(axesHelper)
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
            camera.position.z = 2
            const renderer = new THREE.WebGLRenderer()
            renderer.physicallyCorrectLights = true
            renderer.shadowMap.enabled = true
            renderer.setSize(window.innerWidth, window.innerHeight)
            document.body.appendChild(renderer.domElement)
            const controls = new OrbitControls(camera, renderer.domElement)
            const loader = new GLTFLoader()
            loader.load(
                'models/monkey.glb',
                function (gltf) {
                    gltf.scene.traverse(function (child) {
                        if (child.type === 'Mesh') {
                            let m = child
                            m.receiveShadow = true
                            m.castShadow = true
                        }
                        if (child.type === 'SpotLight') {
                            let l = child
                            l.castShadow = true
                            l.shadow.bias = -0.003
                            //l.shadow.mapSize.width = 2048
                            //l.shadow.mapSize.height = 2048
                        }
                    })
                    progressBar.style.display = 'none'
                    scene.add(gltf.scene)
                    // gltf.animations; // Array<THREE.AnimationClip>
                    // gltf.scene; // THREE.Group
                    // gltf.scenes; // Array<THREE.Group>
                    // gltf.cameras; // Array<THREE.Camera>
                    // gltf.asset; // Object
                },
                (xhr) => {
                    if (xhr.lengthComputable) {
                        var percentComplete = (xhr.loaded / xhr.total) * 100
                        progressBar.value = percentComplete
                        progressBar.style.display = 'block'
                    }
                },
                (error) => {
                    console.log(error)
                }
            )
            window.addEventListener('resize', onWindowResize, false)
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight
                camera.updateProjectionMatrix()
                renderer.setSize(window.innerWidth, window.innerHeight)
                render()
            }
            const stats = Stats()
            document.body.appendChild(stats.dom)
            var animate = function () {
                requestAnimationFrame(animate)
                controls.update()
                render()
                stats.update()
            }
            function render() {
                renderer.render(scene, camera)
            }
            animate()
        </script>
    </body>
</html>
